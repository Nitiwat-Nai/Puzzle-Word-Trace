<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Trace 6.0</title> <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;900&display=swap" rel="stylesheet">
    </head>
<body>

    <div class="container" id="main-container">
        <header id="game-header">
            <h1 id="game-title">Word Trace üëë</h1>
            <span class="version-tag">Version 6.0: Auto-Play Mode</span>
        </header>

        </div>
    
    <script>
        // ... (‡∏™‡πà‡∏ß‡∏ô Utility Functions ‡πÅ‡∏•‡∏∞ DATA ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) ...
        
        // --- GAME STATE ---
        let currentLevelData = null;
        let originalLevelData = null; // To store data for "Play Again"
        let currentQuizIndex = 0;
        let score = 0;
        let isAnswered = false;
        let timerInterval = null;
        let timeRemaining = 0;
        let totalTime = 0;
        let isGameActive = false;
        let isPaused = false; 
        let isAutoPlayMode = false; 
        let autoPlayTimeout = null; 
        let utterance = null; 
        
        let currentGuessWord = "";
        let nextExpectedChar = ""; 

        // --- TTS & UTILITY FUNCTIONS ---
        
        // ******************************************************
        // *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á: speakAnswer ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Auto-Play V6 ***
        // ******************************************************
        function speakAnswer(englishWord, thaiMeaning) {
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ä‡∏∏‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const isLastQuestion = currentQuizIndex + 1 >= currentLevelData.questions.length;

            const onThaiSpeakEnd = () => {
                 utterance.onend = null; 
                 
                 // *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç V6: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏ö ***
                 if (!isLastQuestion) {
                      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡πÉ‡∏´‡πâ‡∏£‡∏≠ 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                      setTimeout(() => {
                        currentQuizIndex++;
                        nextQuestion(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà
                     }, 500); 
                 } else {
                     // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡πÉ‡∏´‡πâ‡∏à‡∏ö‡πÄ‡∏Å‡∏°
                     endGame();
                 }
            };
            
            // ‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏Å‡πà‡∏≠‡∏ô
            const onEnglishSpeakEnd = () => {
                 // ‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ï‡πà‡∏≠
                 speak(thaiMeaning, 'th-TH', onThaiSpeakEnd);
            };

            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå
            speak(englishWord, 'en-US', onEnglishSpeakEnd);
        }

        // ... (‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) ...

        // ******************************************************
        // *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: endQuestion ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô (‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2) ***
        // ******************************************************
        function endQuestion(isCorrect) {
            stopTimer();
            clearAutoPlay(); // Just in case
            isAnswered = true;
            
            // UI Change for End State: Hide all game controls (waiting for auto-next/endGame)
            pauseBtn.style.display = 'none';
            pausedControlsEl.style.display = 'none';
            endLevelControlsEl.style.display = 'none';
            nextQBtn.style.display = 'none';
            
            updateStatusBar();
            
            const q = currentLevelData.questions[currentQuizIndex];
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏ö‡∏ô‡∏à‡∏≠
            englishWordDisplayEl.textContent = `${q.correctWord} (${q.thaiPrompt})`;
            
            // *** V6 ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å speakAnswer ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà/‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ***
            speakAnswer(q.correctWord, q.thaiPrompt);
            
            // *****************************************************************
            // *** ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÇ‡∏Ñ‡πâ‡∏î V5.3 ‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏° nextQBtn ‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß         ***
            // *** ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å speakAnswer() ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ***
            // *****************************************************************
        }

        function endGame() {
            stopTimer(); 
            // ... (‡πÇ‡∏Ñ‡πâ‡∏î endGame ‡πÄ‡∏î‡∏¥‡∏°‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà) ...
            
            // UI Change for Game Over State: Show Play Again and Main Menu buttons
            pauseBtn.style.display = 'none';
            pausedControlsEl.style.display = 'none';
            
            endLevelControlsEl.style.display = 'flex'; // Show new end controls
            nextQBtn.style.display = 'none';
        }

        // ... (‡∏™‡πà‡∏ß‡∏ô INITIAL SETUP ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) ...
    </script>
</body>
</html>
